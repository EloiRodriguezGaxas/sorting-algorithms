<!DOCTYPE html>
<html>

<head>
    <title>Sorting algorithms</title>
</head>
<link rel="stylesheet" href="css/style.css">

<body>

    <h1>Visual Sorting</h1>

    <div class="row">
        <div class="column-1">
            <h2>Settings</h2>
            <div class="slidecontainer">
                <p>Speed: <span id="speed-txt">0.25</span>s</p>
                <input type="range" min="1" max="200" value="50" class="slider" id="speedRange"
                    oninput="sliderSpeedChange()">
                <p>Array length: <span id="length-txt">100</span></p>
                <input type="range" min="1" max="200" value="100" class="slider" id="lengthRange"
                    oninput="sliderLengthChange()">
            </div>
            <button onclick="randomArrayGenerator(true)">Generate array</button>
            <button onclick="startSorting()">Start</button>
        </div>
        <div class="column-2">
            <h2>Output</h2>
            <canvas id="myCanvas" width="800" height="350" style="border:1px solid #d3d3d3;">
        </div>
    </div>
</body>

</html>
<script src="js/bubble.js"></script>
<script>
    var tmp = [];
    var _arr_length = 100;

    function startSorting() {
        var speed = document.getElementById("speedRange").value * 5;
        var bubble = new Bubble(tmp, speed);
        var finished = false;
        var resp, count = 0;
        while (!finished) {
            resp = bubble.sortStep();
            finished = resp.finished;
            if (finished) {
                printArray(resp.arr.slice(0), _arr_length, count * speed, -99, -99);
            } else {
                printArray(resp.arr.slice(0), _arr_length, count * speed, resp.pos1, resp.pos2);
            }
            count++;
        }
    }
    function sliderSpeedChange() {
        var speed = document.getElementById("speedRange").value;
        speed = (speed * 5) / 1000;
        document.getElementById("speed-txt").innerHTML = speed;
    }
    function sliderLengthChange() {
        _arr_length = document.getElementById("lengthRange").value;
        document.getElementById("length-txt").innerHTML = _arr_length;
    }
    function randomArrayGenerator(printOut) {
        tmp = [];
        for (let i = 0; i < _arr_length; i++) {
            tmp.push(Math.floor(Math.random() * 100));
        }
        if (printOut) printArray(tmp.slice(0), _arr_length, 0, -99, -99);
        return tmp;
    }

    function printArray(arr, numBars, time, pos1, pos2) {
        setTimeout(() => {
            // Get canvas context
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");

            var w = c.width / numBars;

            // Clean canvas
            ctx.clearRect(0, 0, c.width, c.height);
            ctx.beginPath();

            // Print bars
            for (let i = 0; i < arr.length; i++) {
                var h = 3.5 * arr[i];
                ctx.strokeStyle = "blue";
                ctx.lineWidth = 1;
                ctx.strokeRect(i * w, 350 - h, w - 1, h);

                if (pos1 == i || pos2 == i)
                    ctx.fillStyle = "#7aeb96";
                else
                    ctx.fillStyle = "#abc7b2";

                ctx.fillRect(i * w, 350 - h, w - 1, h);

            }

        }, time);
    }

</script>